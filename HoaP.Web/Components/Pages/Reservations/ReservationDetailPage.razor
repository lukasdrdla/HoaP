@page "/rezervace/{id:int}"
@inject ReservationService ReservationService
@inject NavigationManager NavigationManager
@rendermode @(new InteractiveServerRenderMode(prerender:false))


    <div class="container py-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3>@reservation.CustomerName #@reservation.Id</h3>
            <button class="btn btn-success">+ Create new booking</button>
        </div>

        <div class="row">
            <!-- Left column -->
            <div class="col-md-8">
                <div class="row mb-4">
                    <div class="col-md-4">
                    <img src="@reservation.RoomImage" alt="Room Image" class="img-fluid rounded">
					<button class="btn btn-outline-secondary mt-3 w-100" @onclick="@(() => NavigateToRoomDetail(reservation.RoomId))">View Room</button>
                    </div>
                    <div class="col-md-8">
                        <h5>Order Details</h5>
                        <p><strong>Order ID:</strong> #@reservation.Id</p>
                        <p><strong>Order Date:</strong> @reservation.CreatedAt</p>
						<p><strong>Check-in:</strong> @reservation.CheckIn.ToShortDateString()</p>
						<p><strong>Check-out:</strong> @reservation.CheckOut.ToShortDateString()</p>
					    <p><strong>Room:</strong> @reservation.RoomTypeName</p>
                        <p><strong>Room Number:</strong> @reservation.RoomNumber</p>
					    <p><strong>Guests:</strong> @reservation.GuestCount</p>
						<p><strong>Speciální požadavky:</strong> @reservation.SpecialRequest</p>
                    </div>
                </div>

                <div class="d-flex gap-3">
				    <button class="btn btn-danger flex-grow-1" @onclick="@(() => OpenDeleteConfirmation(reservation.Id))">Smazat rezervaci</button>
                    <button class="btn btn-outline-secondary flex-grow-1" @onclick="NaviteToRooms">Close</button>
                </div>
            </div>

            <div class="col-md-4">
                <div class="booking-summary">
				    <h5>Celková Cena Rezervace</h5>
                    
                    <div class="summary-item summary-total">
                        <span>Celkem</span>
					    <span>@reservation.TotalPrice Kč</span>
                    </div>

					<a class="btn btn-success w-100 mt-4" href="mailto:@reservation.CustomerEmail">Oznámit rezervaci</a>
                </div>
            </div>
        </div>
    </div>

<DeleteModal IsVisible="@isDeleteModalVisible" OnClose="HandleModalClose" ActionType="DeleteReservation" Title="Smazání rezervace" />

@code {

	[Parameter]
	public int Id { get; set; }
	
	private DetailReservationViewModel reservation = new DetailReservationViewModel();


	private bool isDeleteModalVisible = false;
	int reservationIdToDelete;

	private void OpenDeleteConfirmation(int reservationId)
	{
		reservationIdToDelete = reservationId;
		isDeleteModalVisible = true;
	}

	private void HandleModalClose(bool result)
	{
		if (result)
		{
			ReservationService.DeleteReservationAsync(reservationIdToDelete);
			NavigationManager.NavigateTo("/rezervace");
		}
		isDeleteModalVisible = false;
	}

	


	protected override async Task OnInitializedAsync()
	{
		reservation = await ReservationService.GetReservationByIdAsync(Id);
	}

	private void NavigateToRoomDetail(int roomId)
	{
		NavigationManager.NavigateTo($"/pokoj/{roomId}");
	}

	private void NaviteToRooms()
	{
		NavigationManager.NavigateTo("/rezervace");
	}



}